<div [ngClass]="bem.block()">
  <aui-tab-header
    [selectedIndex]="selectedIndex"
    [type]="type"
    [size]="size"
    (indexFocused)="_focusChanged($event)"
    (selectFocusedIndex)="selectedIndex = $event"
    >
    @if (_tabTitle) {
      <ng-container *auiTabTitle>
        <ng-template [cdkPortalOutlet]="_tabTitle"></ng-template>
      </ng-container>
    }
    @for (tab of _tabs; track tab; let i = $index) {
      <div
        role="tab"
        auiTabLabelWrapper
        cdkMonitorElementFocus
        [class.isActive]="selectedIndex === i"
        [class.closeable]="tab.closeable && !tab.disabled"
        [disabled]="tab.disabled"
        (click)="_handleClick(tab, i)"
        [title]="tab.textLabel"
        [attr.tabIndex]="_getTabIndex(tab, i)"
        [attr.aria-posinset]="i + 1"
        [attr.aria-setsize]="_tabs.length"
        [attr.aria-label]="tab.textLabel"
        >
        <div class="aui-tab-label__content">
          <!-- If there is a label template, use it. -->
          @if (tab.templateLabel) {
            <ng-template [cdkPortalOutlet]="tab.templateLabel"></ng-template>
          }
          <!-- If there is not a label template, fall back to the text label. -->
          @if (!tab.templateLabel) {
            {{ tab.textLabel }}
          }
        </div>
        @if (tab.closeable && !tab.disabled) {
          <aui-icon
            class="aui-tab-label__close"
            icon="xmark_small"
            (click)="tab.close.emit(); $event.stopPropagation()"
          ></aui-icon>
        }
      </div>
    }

    @if (_headerAddon) {
      <ng-container *auiTabHeaderAddon>
        <ng-template [cdkPortalOutlet]="_headerAddon"></ng-template>
      </ng-container>
    }
  </aui-tab-header>

  <div [class]="bem.element('body-wrapper')">
    @if (lazy) {
      @for (tab of activatedTabs; track tab) {
        <aui-tab-body
          role="tabpanel"
          [content]="tab.content"
          [hidden]="tab !== activeTab"
        ></aui-tab-body>
      }
    }
    @if (!lazy && activeTab) {
      <aui-tab-body
        role="tabpanel"
        [content]="activeTab.content"
      ></aui-tab-body>
    }
  </div>
</div>
