import { FormsModule } from '@angular/forms';
import { Canvas, Meta, Story } from '@storybook/addon-docs';
import { moduleMetadata } from '@storybook/angular';

import { TooltipSelectComponent } from './tooltip';

import { SelectModule, IconModule, TooltipModule } from '@alauda/ui';

<Meta
  title="Select"
  decorators={[
    moduleMetadata({
      imports: [FormsModule, SelectModule, IconModule, TooltipModule],
      decorators: [TooltipSelectComponent],
    }),
  ]}
/>

# Select

下拉选择框

## 单选

<Canvas>
  <Story
    name="Single"
    height="240px"
  >
    {{
      template: /* HTML */ `
        <aui-select
          [(ngModel)]="value"
          placeholder="select a value"
        >
          <ng-container *auiOptionContent>
            <aui-option
              *ngFor="let option of arr"
              [value]="option"
              [disabled]="option === 'option5'"
            >
              {{ option }}
            </aui-option>
          </ng-container>
          <aui-option-placeholder>Empty</aui-option-placeholder>
        </aui-select>
        <br />
        <br />
        value: {{ value }}
      `,
      props: {
        arr: Array.from({ length: 11 })
          .fill(null)
          .map((_, i) => `option${i + 1}`),
        value: '',
      },
    }}
  </Story>
</Canvas>

## 单选分组

<Canvas>
  <Story
    name="Group"
    height="360px"
  >
    {{
      template: /* HTML */ `
        <aui-select
          [(ngModel)]="value"
          [labelFn]="labelFn"
          [trackFn]="trackFn"
        >
          <aui-option-group *ngFor="let i of arr">
            <div auiOptionGroupTitle>group {{ i }}</div>
            <aui-option
              *ngFor="let j of arr"
              [label]="'option' + (arr.length * i + j)"
              [value]="{ key: 'option' + (arr.length * i + j) }"
            >
              <aui-icon icon="sun"></aui-icon>
              option {{ arr.length * i + j }}
            </aui-option>
          </aui-option-group>
          <aui-option-placeholder>Empty</aui-option-placeholder>
        </aui-select>
        <br />
        <br />
        value: {{ value | json }}
      `,
      props: {
        arr: Array.from({ length: 5 })
          .fill(null)
          .map((_, i) => i + 1),
        value: { key: Symbol('special'), value: 'option11' },
        labelFn: option => option?.value,
        trackFn: val => (val ? val.key || val : val),
      },
    }}
  </Story>
</Canvas>

## 加载中

<Canvas>
  <Story
    name="Loading"
    height="100px"
  >
    {{
      template: /* HTML */ `
        <aui-select
          [(ngModel)]="value"
          [loading]="true"
        >
          <aui-option
            *ngFor="let option of arr"
            [value]="option"
          >
            {{ option }}
          </aui-option>
          <aui-option-placeholder>Empty</aui-option-placeholder>
        </aui-select>
      `,
      props: {
        arr: ['option'],
        value: '',
      },
    }}
  </Story>
</Canvas>

## 禁用

<Canvas>
  <Story
    name="Disabled"
    height="100px"
  >
    {{
      template: /* HTML */ `
        <aui-select
          [(ngModel)]="value"
          [disabled]="true"
        >
          <aui-option
            *ngFor="let option of arr"
            [value]="option"
          >
            {{ option }}
          </aui-option>
          <aui-option-placeholder>Empty</aui-option-placeholder>
        </aui-select>
      `,
      props: {
        arr: ['option'],
        value: 'option',
      },
    }}
  </Story>
</Canvas>

## 可清除和可创建

<Canvas>
  <Story
    name="ClearableAndAllowCreate"
    height="300px"
  >
    {{
      template: /* HTML */ `
        <aui-multi-select
          [(ngModel)]="value"
          [clearable]="true"
          [allowCreate]="true"
        >
          <aui-option
            *ngFor="let option of arr"
            [value]="option"
          >
            {{ option }}
          </aui-option>
          <aui-option-placeholder>Empty</aui-option-placeholder>
        </aui-multi-select>
      `,
      props: {
        arr: ['option', 'option1', 'option2'],
        value: ['option'],
      },
    }}
  </Story>
</Canvas>

## 可筛选

<Canvas>
  <Story
    name="Filterable"
    height="300px"
  >
    {{
      template: /* HTML */ `
        <aui-select
          [(ngModel)]="value"
          [filterable]="true"
          [filterFn]="filterFn"
        >
          <aui-option
            *ngFor="let option of arr"
            [value]="option"
            [label]="option.key"
          >
            {{ option.key }}
          </aui-option>
          <aui-option-placeholder>Empty</aui-option-placeholder>
        </aui-select>
      `,
      props: {
        arr: Array.from({ length: 5 })
          .fill(null)
          .map((_, i) => ({
            key: `option${i + 1}`,
          })),
        value: '',
        filterFn: (keyword, option) =>
          !keyword || option.value.key.includes(keyword),
      },
    }}
  </Story>
</Canvas>

## 多选

<Canvas>
  <Story
    name="Multiple"
    height="440px"
  >
    {{
      template: /* HTML */ `
        <aui-multi-select
          [(ngModel)]="value"
          [maxRowCount]="6"
          [allowSelectAll]="true"
          [clearable]="true"
          [trackFn]="trackFn"
        >
          <aui-option
            *ngFor="let option of arr"
            [label]="option.value"
            [value]="option"
            [disabled]="option.value === 'option5'"
          >
            {{ option.value }}
          </aui-option>
          <aui-option-placeholder>Empty</aui-option-placeholder>
        </aui-multi-select>
      `,
      props: {
        arr: Array.from({ length: 10_000 })
          .fill(null)
          .map((_, i) => ({ value: `option${i + 1}` })),
        value: [{ value: 'option1' }, { value: 'option5' }],
        trackFn: ({ value }) => value,
      },
    }}
  </Story>
</Canvas>

## 大量数据

<Canvas>
  <Story
    name="virtual"
    height="440px"
  >
    {{
      template: /* HTML */ `
        <aui-multi-select
          [(ngModel)]="value"
          [clearable]="true"
          [useVirtual]="true"
          [trackFn]="trackFn"
        >
          <aui-option
            *ngFor="let option of arr"
            [label]="option.value"
            [value]="option"
            [disabled]="option.value === 'option5'"
          >
            {{ option.value }}
          </aui-option>
        </aui-multi-select>
        <br />
        value: {{ value | json }}
      `,
      props: {
        arr: Array.from({ length: 10_000 })
          .fill(null)
          .map((_, i) => ({ value: `option${i + 1}`, disabled: i === 5 })),
        value: [{ value: 'option2' }, { value: 'option1001' }],
        trackFn: ({ value }) => value,
      },
    }}
  </Story>
</Canvas>

## 使用 options

通过 options 直接传入选项内容

<Canvas>
  <Story
    name="options"
    height="340px"
  >
    {{
      template: /* HTML */ `
        <aui-select
          [(ngModel)]="value"
          [options]="options"
        >
        </aui-select>
        <br />
        value: {{ value | json }}
      `,
      props: {
        options: Array.from({ length: 50 })
          .fill(null)
          .map((_, i) => ({ value: `option${i + 1}`, disabled: i === 5 })),
      },
    }}
  </Story>
</Canvas>

## labelContext

可以使用 label 指定 templateRef，以实现选中的自定义内容。通过 labelContext 指定上下文
利用 content 投影自定义下拉选项内容

<Canvas>
  <Story
    name="labelContext"
    height="340px"
  >
    {{
      template: /* HTML */ `
        <aui-select [(ngModel)]="value">
          <aui-option
            [label]="option"
            [labelContext]="{ cluster: cluster }"
            [value]="cluster.value"
            *ngFor="let cluster of arr"
          >
            <ng-container
              *ngTemplateOutlet="option; context: { cluster: cluster }"
            ></ng-container>
          </aui-option>
          <ng-template
            #option
            let-cluster="cluster"
          >
            <div>{{cluster.value + 'gauch'}}</div>
          </ng-template>
        </aui-select>
        <br />
        value: {{ value | json }}
      `,
      props: {
        arr: Array.from({ length: 5 })
          .fill(null)
          .map((_, i) => ({ value: `option${i + 1}` })),
      },
    }}
  </Story>
</Canvas>

## 复杂使用

<Canvas>
  <Story
    name="complex"
    height="600px"
  >
    {{
      component: TooltipSelectComponent,
    }}
  </Story>
</Canvas>

## Select & MultiSelect Inputs

| 名称               | 类型           | 默认值                           | 描述                                      |
| ------------------ | -------------- | -------------------------------- | ----------------------------------------- |
| size               | ComponentSize  | ComponentSize.Medium             | 大小                                      |
| value              | any            | -                                | 初始值                                    |
| placeholder        | string         | -                                | 占位文本                                  |
| disabled           | boolean        | false                            | 是否禁用                                  |
| loading            | boolean        | false                            | 是否加载中                                |
| clearable          | boolean        | false                            | 选项是否可清除                            |
| allowCreate        | boolean        | false                            | 是否可以直接创建一个选项                  |
| filterable         | boolean        | true                             | 是否支持选项过滤                          |
| defaultFirstOption | boolean        | true                             | 是否第一项作为默认选项                    |
| lazy               | boolean        | true                             | 关闭候选项时是否缓存 Option 组件          |
| filterFn           | OptionFilterFn | Array.property.includes          | 自定义过滤方法，filterable 为 true 时设置 |
| trackFn            | TrackFn        | val => val                       | 返回 value 唯一标识符                     |
| createFn           | CreateFn       | inputVal => \{ value: inputVal } | 返回 option 组件配置                      |
| options            | DisplayOption  | -                                | 使用 options 定义选项列表                 |
| useVirtual         | boolean        | false                            | 是否使用虚拟列表                          |

## MultiSelect Inputs

| 名称        | 类型       | 默认值 | 描述                 |
| ----------- | ---------- | ------ | -------------------- |
| tagClassFn  | TagClassFn | -      | 选中项的 class 定义  |
| maxRowCount | number     | -      | 多选输入框的最大行数 |

## Select & MultiSelect Outputs

| 名称         | 类型   | 默认值 | 描述         |
| ------------ | ------ | ------ | ------------ |
| show         | -      | -      | 显示时调用   |
| hide         | -      | -      | 隐藏时调用   |
| filterChange | string | -      | input 值变化 |
| valueChange  | any    | -      | 选中值变化   |

## Option Inputs

| 名称         | 类型                  | 默认值 | 描述                                                  |
| ------------ | --------------------- | ------ | ----------------------------------------------------- |
| label        | string or TemplateRef | -      | 选中后 select 显示的文案                              |
| labelContext | Object                | -      | 当 label 为 template 时设置，传递到 template 的上下文 |
| disabled     | boolean               | false  | 是否禁用                                              |
| value        | any                   | -      | 选项的值                                              |
